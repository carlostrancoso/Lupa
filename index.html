<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lupa</title>
    <link type="text/css" rel="stylesheet" href="./main.css">

    <script  type="importmap">{
      "imports": {
        "three": "https://threejs.org/build/three.module.js"
      }
    }</script><!-- Remove this when import maps will be widely supported -->
    <script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>
    <script type="module">

     //bibliotecas
     import * as THREE from 'three';
     import {OrbitControls} from 'https://threejs.org/examples/jsm/controls/OrbitControls.js';
     import {OBJLoader} from 'https://threejs.org/examples/jsm/loaders/OBJLoader.js';
     import {MTLLoader} from 'https://threejs.org/examples/jsm/loaders/MTLLoader.js';


//loading screen

const manager = new THREE.LoadingManager();
  const loadingContainer = document.querySelector('.loading-screen')


manager.onError = function ( url ) {

	console.log( 'There was an error loading ' + url );

};



      //janela e motor render
      var canvas = document.querySelector('#webgl');
      var renderer = new THREE.WebGLRenderer({canvas, alpha:true});
      renderer.setClearColor( 0xEDEDED, 0 );

      //cena e fundo 
      //const bgcolor = new THREE.Color(0xEDEDED);
      const bgcolor = new THREE.Color('black');
      const scene = new THREE.Scene();
      scene.background = bgcolor;

    // Camera
    const camera = new THREE.PerspectiveCamera(75, 2, 0.1, 100)
    scene.add(camera)

    // Controls
    //const controls = new OrbitControls(camera, canvas)
    //controls.enableDamping = true
    //controls.enabled = true

    //redimensionamento da janela

  function resizeRendererToDisplaySize(renderer) {
    var canvas = renderer.domElement;
    var width = canvas.clientWidth;
    var height = canvas.clientHeight;
    var needResize = canvas.width !== width || canvas.height !== height;
    if (needResize) {
      renderer.setSize(width, height, false);
    }
    return needResize;
  }

  //luz ambiente

  const light = new THREE.AmbientLight( 0xffffff, 2 ); // soft white light
  scene.add( light );

  //luz vermelha
  {
    var color = 0xE7071B;
    var intensity = 4;
    var rlight = new THREE.DirectionalLight(color, intensity);
    rlight.position.set(5, 50, 10);
    scene.add(rlight);
    scene.add(rlight.target);
  }
   
    //luz azul
  {
    var color = 0x0000FF;
    var intensity = 3; 
    var blight = new THREE.DirectionalLight(color, intensity);
    blight.position.set(10, 12, 2);
    scene.add(blight);
    scene.add(blight.target);
  }
   
    //luz verde
    
  {
    var color = 0x00FF00;
    var intensity = 2;
    var glight = new THREE.DirectionalLight(color, intensity);
    glight.position.set(-10, 5, 2);
    scene.add(glight);
    scene.add(glight.target);
  }


  // Object
const cube = new THREE.Mesh(
    new THREE.BoxGeometry(1, 1, 1, 5, 5, 5),
    new THREE.MeshBasicMaterial({ color: 0xff0000 })
)
scene.add(cube)
cube.visible = false

  //lupa
var lupa;
  {
    var objLoader = new OBJLoader(manager);
    var mat = new THREE.MeshPhysicalMaterial({});
mat.reflectivity = 0
mat.transmission = 1
mat.roughness = 0.2
mat.metalness = 0
mat.clearcoat = 0.3
mat.clearcoatRoughness = 0.25
mat.color = new THREE.Color(0xffffff)
mat.ior = 1.2
mat.thickness = 5

objLoader.load('LUPA.obj', function (obj) {
        obj.traverse(function (child) {

            if (child instanceof THREE.Mesh) {
                child.material = mat;
                mat.side = THREE.DoubleSide;
            }

        });
        lupa = obj;
        scene.add(lupa);
      lupa.rotation.x = Math.PI;
      lupa.rotation.z = Math.PI;
    });
    }

    //bustos

    var busto;
    const oldObjectPosition = new THREE.Vector3();
  {
    var mtlLoader = new MTLLoader(manager);
    mtlLoader.load('BUSTO_2.mtl', (mtl) => {
      mtl.preload();
      for (var material of Object.values(mtl.materials)) {
     material.side = THREE.DoubleSide;
      }
      var objLoader = new OBJLoader(manager);
      objLoader.setMaterials(mtl);
      objLoader.load('BUSTO_2.obj', (mesh) => {
        busto = mesh;
        scene.add(busto);
        busto.rotation.x = Math.PI;
        busto.rotation.z = Math.PI;
        busto.visible = true;
        
        lupa.getWorldPosition(oldObjectPosition);
      });
    });

  }

  // Cursor
const cursor = {
    x: 0,
    y: 0
}

const cursor2 = {
    x: 0,
    y: 0
}
window.addEventListener('mousemove', (event) =>
{
    cursor.x = event.clientX / canvas.clientWidth - 0.5
    cursor.y = - (event.clientY / canvas.clientHeight - 0.5)

})

window.addEventListener('click', (event) =>
{
    cursor2.x = event.clientX / canvas.clientWidth - 0.5
    cursor2.y = - (event.clientY / canvas.clientHeight - 0.5)

})



    const tick = () =>
{

  const cameraOffset = new THREE.Vector3(0.0, 0.5, 3  ); // NOTE Constant offset between the camera and the target

// NOTE Assuming the camera is direct child of the Scene
const objectPosition = new THREE.Vector3();
if(lupa) lupa.getWorldPosition(objectPosition);

camera.position.copy(objectPosition).add(cameraOffset);

  //Update window
  if (resizeRendererToDisplaySize(renderer)) {
      var canvas = renderer.domElement;
      camera.aspect = canvas.clientWidth / canvas.clientHeight;
      camera.updateProjectionMatrix();
    }

    if(lupa) lupa.position.x = Math.sin(cursor.x * Math.PI/2) * 3
    //if(lupa) lupa.position.z = Math.cos(cursor.x * Math.PI/2) * 3
    if(lupa) lupa.position.y = cursor.y * 5

    if(busto) busto.rotation.y = cursor2.x * 2

    /* // Update camera
    camera.position.x = Math.sin(cursor.x * Math.PI/2) * 3
    camera.position.z = Math.cos(cursor.x * Math.PI/2) * 3
    camera.position.y = cursor.y * 4
    camera.lookAt(cube.position) */

    //if(busto) busto.rotation.x += 0.001;

     // Update controls
     //controls.update()

    // Render
    renderer.render(scene, camera)


    // Call tick again on the next frame
    window.requestAnimationFrame(tick)
}

tick()



    </script> 
</head>
<body>
  <div class="info">
    <div class="message"><h3>Lupa</h3><br>Micro-site em manutenção</div>
    <br />
    <button class="ok" onclick="this.parentElement.style.display='none';">OK</button>
</div>


<div class="topnav">
  <a href="https://carlostrancoso.github.io/Busto/">Anterior</a>
  <div class="topnav-right">
    <a href="https://carlostrancoso.github.io/Nuvem/">Próximo</a>
  </div>

</div>
    <canvas id="webgl"></canvas>
</body>
</html>
